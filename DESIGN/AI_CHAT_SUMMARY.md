Here is the comprehensive **Master Project Summary** and **Handover Document**. You can copy-paste this directly into a new chat or save it as `PROJECT_HANDOVER.md` to resume work seamlessly.

---

# ðŸš€ PROJECT HANDOVER: 4-Channel 20A Smart Plug
**Status:** âœ… **Design Frozen & Ready for Manufacturing**
**Date:** Feb 7, 2026
**Target Manufacturer:** JLCPCB / PCBWay

## 1. System Specifications
*   **Application:** High-power (20A/230V) 4-Channel Relay Control.
*   **Controller:** ESP32-DevKitC V4 (Socketed).
*   **Power Input:** 230V AC (Logic & Switching).
*   **Switching Capacity:** 30A Relays (derated to 20A safe continuous load).
*   **PCB Specs:** 2-Layer, **1.6mm Thickness**, **2oz Copper** (70Âµm).

---

## 2. Electrical Design (Schematic)
*   **Power Supply:**
    *   **Module:** **HLK-10M05** (10W / 5V / 2A). *Selected to handle 1.4A peak load.*
    *   **Protection:** Fuse (`F1`, 10A) + Varistor (`RV1`) on logic input.
    *   **LDO:** AMS1117-3.3 for ESP32/Logic power.
*   **Relay Logic (Discrete):**
    *   **Switching:** **SS8050** NPN Transistors (SOT-23).
    *   **Protection:** **1N4148W** Flyback Diodes (SOD-123).
    *   **Base Resistors:** 1kÎ© (0805).
*   **IO Expansion:**
    *   **Chip:** MCP23017 (I2C) handling Buttons and Relay signals.
    *   **Interrupts:** `INTA` and `INTB` connected together ("Wired-OR") $\rightarrow$ 10k Pull-up $\rightarrow$ Single ESP32 GPIO.
*   **Connections:**
    *   **J1 (Logic Power):** KF7.62-3P (L, N, PE). *Powers PCB only.*
    *   **T_IN / T_OUT (Load):** Faston Tabs (6.35mm). *Switches Line (L) only.*

---

## 3. Physical Layout (PCB)
*   **High Current Path (20A):**
    *   **Routing:** Massive **Polygon Pours** (Red/Top & Blue/Bottom).
    *   **Width:** ~14mm on both layers (Effective 28mm).
    *   **Connection Style:** **Direct Connect** (Solid copper, no thermal spokes) to Relay pins and Faston tabs to prevent burnout.
    *   **Solder Mask:** Tented (Closed). No manual solder addition required due to 2oz copper width.
*   **Safety & Isolation:**
    *   **Air Gap:** Minimum **3.0mm** clearance between High Voltage AC and Low Voltage DC.
    *   **Earth (PE):** 3mm wide Guard Ring around the PCB edge, connected to mounting holes. Used for **Shielding/ESD only**.
    *   **High Current Earth:** Wired **OFF-BOARD** (Wall $\to$ Wago $\to$ Socket) to bypass the PCB trace.
*   **Components:**
    *   **J2 (ESP32):** Replaced with **2x Female Headers (1x19P)**. Marked as "Do Not Populate" for assembly (Hand solder later).
    *   **PSU Placement:** HLK-10M05 moved >5mm away from J1 for screwdriver access.

---

## 4. Engineering Calculations (Python Verified)
*   **Total System Peak Current:** ~1.41 A
*   **PSU Capacity:** 2.0 A (HLK-10M05) $\rightarrow$ **PASS** (Safe Margin).
*   **Trace Widths (2oz Copper, +10Â°C Rise):**
    *   **AC 20A:** Polygon Pour required (Verified).
    *   **DC 5V Rail:** **0.80 mm** (Calculated for voltage stability).
    *   **DC 3.3V Rail:** **0.40 mm** (Calculated for ESP32 bursts).
    *   **Relay GND Return:** **0.60 mm** (Sinks all 4 coils).

---

## 5. Manufacturing Instructions (JLCPCB/PCBWay)
**Upload the Zip file generated by `package_gerbers.py`.**

**Select these settings:**
*   **Layers:** 2
*   **Thickness:** **1.6 mm** (Crucial for mechanical strength).
*   **Copper Weight:** **2 oz** (Outer Layer) **<-- CRITICAL**.
*   **Solder Mask:** Blue.
*   **Silkscreen:** White.
*   **Surface Finish:** HASL (Lead) or Lead-Free HASL.

---

## 6. Assembly & "DIY" Actions
1.  **ESP32 Headers:** Buy 2x `1x19 Pin 2.54mm Female Headers`. Hand-solder them into the `J2` position. Plug the ESP32 into them.
2.  **Faston Tabs:** These require a high-power soldering iron (60W+) because of the "Direct Connect" copper pours.
3.  **Wiring:**
    *   **Live (L):** Wall $\to$ Wago $\to$ PCB Tabs.
    *   **Neutral (N):** Wall $\to$ Wago $\to$ Sockets (Branch thin wire to PCB J1).
    *   **Earth (PE):** Wall $\to$ Wago $\to$ Sockets (Branch thin wire to PCB J1 for shielding).

---

## 7. Python Scripts
We developed a modular Python suite (`pcb_power_tool`) to validate the design:
*   `peak_data.json`: The "Source of Truth" for component loads.
*   `config.py`: Engineering constants (IPC factors, Safety margins).
*   `calculator.py`: Physics calculations.
*   `analyzer.py`: Business logic & Recommendations.
*   `power_calculations.py` (Main): Generates the `PCB_Engineering_Report.md`.

**End of Summary.** You are ready to move to the next phase! ðŸš€