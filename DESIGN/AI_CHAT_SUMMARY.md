This is the **Final Project Archive**. It contains every decision, specification, component choice, layout rule, and code snippet we developed.

You should save this content into a folder structure on your computer (e.g., `/Docs`, `/Scripts`, `/BOM`) to preserve the engineering history.

---

# üìÇ PROJECT ARCHIVE: 4-Channel 20A Smart Plug System
**Version:** 1.0 (Ready for Manufacturing)
**Date:** February 18, 2026
**Fabrication Target:** JLCPCB / PCBWay

---

## 1. üìã System Specifications

*   **Application:** Heavy-duty AC load switching (Heaters, Motors, Pumps).
*   **Capacity:** 4 Channels x 20A (Continuous) / 30A (Peak).
*   **Input Voltage:** 230V AC (50Hz/60Hz).
*   **Logic Power:** 10W Internal Isolated Supply (5V / 2A).
*   **Controller:** ESP32-DevKitC V4 (Wi-Fi/Bluetooth).
*   **PCB Specs:** 2-Layer FR-4, **1.6mm Thickness**, **2oz (70¬µm) Copper**.

---

## 2. ‚ö° Electrical Design (Schematic)

### A. AC Logic Power Input (The "Safety Chain")
*Designed for EMC compliance and surge protection.*
1.  **Input:** Terminal Block `KF7.62-3P` (Live, Neutral, Earth Shield).
2.  **Protection:**
    *   **Fuse (`F1`):** 1A Slow Blow (Protects logic trace only).
    *   **NTC (`NTC1`):** `10D-7` (10Œ©). Limits inrush current to protect the Fuse/PSU.
    *   **MOV (`RV1`):** `14D471K` (470V). Clamps lightning/grid surges.
3.  **EMI Filtering:**
    *   **X2 Capacitor:** 100nF / 275VAC (Across L-N).
    *   **Common Mode Choke:** `UU9.8` 10mH (Series).
    *   **Y-Capacitor:** 2.2nF / 400V **Y1 Class**. (Bridges AC Neutral $\to$ DC Ground for noise return).
4.  **Power Module:** Hi-Link **HLK-10M05** (10W).

### B. DC Power Distribution
1.  **5V Rail:** Filtered by **220¬µF Electrolytic** (Bulk) + **100nF Ceramic** (HF Noise).
2.  **3.3V Rail:** Generated by **AMS1117-3.3** LDO. Filtered by 220¬µF + 100nF.

### C. Relay Control (Discrete Logic)
*Repeated 4 times.*
*   **Driver:** `SS8050` NPN Transistor (SOT-23).
*   **Base:** 1kŒ© Resistor.
*   **Flyback:** `1N4148W` Diode (SOD-123) across coil.
*   **Indication:** LED + 470Œ© Resistor in parallel with coil.
*   **Relay:** Hongfa **HF105F-1/005D-1HST** (30A rating, High Power).

### D. Digital Logic
*   **IO Expander:** `MCP23017` (I2C) controls Relays and reads Buttons.
*   **Interrupts:** `INTA` + `INTB` shorted (Wired-OR) $\to$ 10k Pull-up $\to$ ESP32 GPIO.
*   **ESP32:** Mounted via **Female Headers** (Not soldered directly).

---

## 3. üìê PCB Layout & Design Rules

**Material:** FR-4, **1.6mm**, **2oz Copper**, Blue Solder Mask.

### A. Trace Widths (Calculated for 2oz Copper)
| Net Function | Load | Rule Width | Notes |
| :--- | :--- | :--- | :--- |
| **AC Load** | 20A | **Polygon Pour** | ~14mm wide solid pour. **Direct Connect** style (No thermal spokes). |
| **AC Mains Input** | 0.2A | **1.00 mm** | Mechanical robustness rule. |
| **DC +5V Rail** | 1.7A | **0.80 mm** | Voltage stability for ESP32 Wi-Fi bursts. |
| **DC Relay GND** | 0.9A | **0.60 mm** | Common return for 4 coils. |
| **DC +3.3V Rail** | 0.6A | **0.40 mm** | LDO Output. |
| **Signals** | 0.05A | **0.25 mm** | Standard DfM. |

### B. Safety & Isolation
*   **Air Gap:** Minimum **3.0mm** clearance between AC High Voltage and DC Low Voltage regions.
*   **Guard Ring:** 3mm wide Earth (PE) track around the board edge connecting all mounting holes.
*   **Polygon Styling:** AC High Current pads must use **Direct Connect** rules to prevent thermal relief spokes from acting as fuses.

---

## 4. üì¶ Bill of Materials (Key Parts)

| Designator | Component | Specs / Part # | Package | Qty |
| :--- | :--- | :--- | :--- | :--- |
| **PS1** | Power Module | **HLK-10M05** (10W) | Module | 1 |
| **K11-K14** | Relay | **HF105F-1/005D-1HST** | THT | 4 |
| **FT_xx** | Faston Tab | **726386-2** (6.35mm) | THT | 8 |
| **Q11-Q14** | Transistor | **SS8050** | SOT-23 | 4 |
| **U1** | LDO | **AMS1117-3.3** | SOT-223 | 1 |
| **U2** | IO Expander | **MCP23017-E/SS** | SSOP-28 | 1 |
| **J2** | Socket | **Female Header 1x19** | 2.54mm | 2 |
| **CX1** | Safety Cap | **100nF 275V X2** | P=10mm | 1 |
| **CY1** | Safety Cap | **2.2nF 400V Y1** | P=10mm | 1 |
| **L1** | Choke | **UU9.8 10mH** | THT | 1 |
| **RV1** | MOV | **14D471K** | Disc 14mm | 1 |
| **NTC1** | Thermistor | **10D-7** | Disc 10mm | 1 |

---

## 5. üõ†Ô∏è Assembly & Wiring Guide

### PCB Assembly
1.  **ESP32:** Do not solder the ESP32 module. Solder the two **Female Header Strips**. Plug the ESP32 in.
2.  **Faston Tabs:** Use a high-power iron (60W+). The "Direct Connect" 2oz copper will suck heat away rapidly.
3.  **Orientation:** Ensure Diodes (SOD-123) and ICs are oriented correctly per the silkscreen dot/line.

### External Wiring (Safety Critical)
*   **Earth (PE):** Connect Wall Earth $\to$ Wago Block $\to$ Output Socket Earths. **Do not run the 20A fault current through the PCB.** Connect a single thin wire from the Wago to the PCB `J1-PE` for shielding.
*   **Neutral (N):** Wall Neutral $\to$ Wago Block $\to$ Output Sockets. Branch a wire to PCB `J1-N`.
*   **Live (L):** Wall Live $\to$ Wago Block $\to$ PCB `FT_IN` Tabs.

---